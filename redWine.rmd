---
title: "Red Wine Exploratory Data Analysis"
author: "Shrey Marwaha"
date: "September 20, 2017"
output: html_document
---

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Loading required libraries
library(ggplot2)
library(stringr)
library(GGally)
library(reshape2)
library(dplyr)
library(tidyr)
library(gridExtra)
library(corrplot)
library(lsr)
```

## Objectives

Through this project, I aim to explore and analyse the Red Wine Data Set, and infer the factors on which the quality of wine depends. I will start by exploring the data to get a feel of the information available and then, if possible, I hope to draw out the correlations between the various vaiables and Wine Quality. Through this, I aim to create a predictive model and check it against a test data.

```{r echo=FALSE, Load_the_Data}
# Load the Data
rdw <- read.csv('wineQualityReds.csv')

# Wrangling the data
rdw$quality <- factor(rdw$quality, ordered = TRUE)
#Creating new ordered categorical variable Class
rdw$class <- factor(ifelse(rdw$quality < 5, 'poor', 
                              ifelse(rdw$quality < 7, 'normal', 'exceptional')
                              ))

rdw$class <- ordered(rdw$class, levels = c('poor','normal','exceptional'))
```

## Structure and summary of the Dataframe

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
str(rdw)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(rdw)
```
# Univariate Plots Section

As a start, I see from the above statistics that there are a lot more number of **normal** 
red wines in the data, than 'poor' and 'exceptional'. Let's have a visual look at this by 
checking quality factor.

```{r echo=FALSE, Univariate_Plots}
ggplot(data = rdw, aes(x = quality))+
  geom_bar(fill = I('#40B0B5'))
```

That shows it quite clearly, as is mentioned in the Info file. I wonder if wines with 
quality rating 8 (exceptional) and quality rating 3 (poor) are outliers.

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Plotting all variables together, ommitting factor variables
rdw_compiled <- gather(rdw, "variable", "value", 2:12, factor_key = TRUE)
ggplot(aes(x = value), data = rdw_compiled)+
  geom_histogram(fill = I('#40B0B5') )+
  facet_wrap(~variable, scales = "free")
```

From the above initial plots, a lot of interesting things can be seen. Many variables are showing some kind of a relationship which can be of particular interest to us. Let's examine some of these further. I'll go about doing this category wise, namely: Acidity, Chemicals and Other features.

###Acidity

From the data, we can see that pH, fixed.acidity, volatile.acidity and citric.acid 
basically correspond to this category. Let's have a look at their distributions, together.

```{r echo=FALSE, message=FALSE, warning=FALSE}
p1 <- ggplot(data = rdw, aes(x = fixed.acidity))+
  geom_histogram(fill = '#338C90', binwidth = 0.1)+
  coord_cartesian(xlim = c(4, 14))
p2 <- ggplot(data = rdw, aes(x = volatile.acidity))+
  geom_histogram(fill = '#338C90', binwidth = 0.01)+
  coord_cartesian(xlim = c(0, 1))
p3 <- ggplot(data = rdw, aes(x = citric.acid))+
  geom_histogram(fill = '#338C90', binwidth = 0.01)
p4 <- ggplot(data = rdw, aes(x = pH))+
  geom_histogram(fill = '#338C90')
grid.arrange(p1, p2, p3, p4, ncol = 1)
```

From the above plots, we can see that fixed.acidity has more of a positively skewed distribution, it probably may be bimodal. The volatile.acidity variable also looks like a skewed distribution, though we may want to look at it further. There isn't much to be infered from the citric.acid plot, and the pH plot has a uniform distribution with most values concentrated between 3.0 and 3.5. That's quite accurate as wines are mildly acidic. The acidity adds to it's crispiness.

I would like to see some x-axis transformations in citric.acid plot to extract any available information.

```{r echo=FALSE, message=FALSE}
ggplot(data = rdw, aes(x = citric.acid))+
  geom_histogram(fill = '#338C90', binwidth = 0.01)+
  scale_x_sqrt()
```

After a sqrt tranformation on x-axis, I can see that although there isn't 
relation visible, but many of the values have zero amount of citric acid in them. 
This probably depends on the flavor of the wine, and probably affects the quality.

###Chemicals
Let's check for presence of chemicals such as chlorides, sulphates & sulfur dioxide.

```{r echo=FALSE, message=FALSE}
c1 <- ggplot(data = rdw, aes(x = chlorides))+
  geom_histogram(fill = '#47979B')
c2 <- ggplot(data = rdw, aes(x = sulphates))+
  geom_histogram(fill = '#47979B')

grid.arrange(c1, c2, ncol = 1)
```

Both these curves show skewed distribution, and a large number of outliers.
It's possible that these abnormal values may distinguish the quality/class of 
the wine, as presence of long tailed data is visible.

```{r echo=FALSE, message=FALSE}
s1 <- ggplot(data = rdw, aes(x = free.sulfur.dioxide))+
  geom_histogram(fill = '#7EB6B9')+
  coord_cartesian(xlim = c(0, 60))
s2 <- ggplot(data = rdw, aes(x = total.sulfur.dioxide))+
  geom_histogram(fill = '#7EB6B9')+
  coord_cartesian(xlim = c(0, 200))

grid.arrange(s1, s2, heights = unit(1, 'npc'))
```

Both these variables show somewhat similar skewness. The free sulphur dioxide 
amount peaks at two places, first at 7 which is the median, and then around 9-10. 
Both have a small number of outliers that have been omitted from the visualizations.

###Other Parameters

Let's look at residual sugar, density and alcohol levels.

```{r echo=FALSE, message=FALSE}
# Residual Sugar 
o1 <- ggplot(data = rdw, aes(x = residual.sugar))+
  geom_histogram(fill = '#7eb6b9')
# Density
o2 <- ggplot(data = rdw, aes(x = density))+
  geom_histogram(fill = '#7e99b9')
#Alcohol
o3 <- ggplot(data = rdw, aes(x = alcohol))+
  geom_histogram(fill = '#7eb99f')
grid.arrange(o1, o2, o3, ncol = 1)
```

Residual sugar has very high outliers, while the 75th percentile is at 2.60 only. 
The distribution is positively skewed with median around 2.20. Density seems to be
a uniform distribution, which can hence be a deciding factor in quality. Alcohol 
percentages are mostly positively skewed.

# Univariate Analysis

### Structure of the Dataset

The Red Wine Dataset has 1599 rows and 13 columns. I've added a new column called 'class' 
based on the quality ratings. Also, both class and Quality have been transformed into factor variables for easy modelling. Final number of variables is 14.

### Feature(s) of Interest

Most data points belong to the **normal** class of wines. This is either a good indication, or implies that data is incomplete. Analysis of multiple variables with quality may clear this up further. Although I'm no wine expert, a predictive model may help in determining what affects
Quality of a Red wine, which is the main objective of this analysis.

### Supporting Points of Interest

From the intial analysis it seems that variables such as factors related to acidity and pH may be some deciding factors for quality, since the taste is affected by these. By the same clause, chlorides and residual sugars may also affect the perception of quality.  

### Unusual Observations

1. The plot of citric.acid qauntity seemed to have no particular relationship going on. A large number of values were seemingly zero, which is either an indication of quality, or incomplete data. To better visualize it, I used the square root transformation, because log transformation would have lead to non-finite values.

2. Other variables such as chlorides, sulphates and residual sugar have many outliers. It intrigues me if these actually propose a measure of quality or are just dirty values.


# Bivariate Plots Section

Although I have some bivariate analyses in mind, I will start by creating a correlation plot to double check my thoughts.

```{r echo=FALSE, message=FALSE, Bivariate_Plots}

# Creating an all numeric df
rdw_new <- rdw[, 2:13]
rdw_new$quality <- as.numeric(rdw_new$quality)
# Finding correlation matrix
rdw_cor <- cor(x = rdw_new, method = 'pearson')
# Plotting correlation plot
col <- colorRampPalette(c("#4799d3", "#9ac3e0", "#FFFFFF", "#aaffc8", "#33ce6a"))

corrplot(rdw_cor, method="color", col = col(200), order="original", 
         addCoef.col = "black",
         tl.col="black", tl.srt = 90, tl.cex = 0.9, # Variable Labels
         number.cex = 0.7, number.digits = 2,       # Correlation Coeffs.
         cl.cex = 0.7, cl.align.text = "c",         # Color Label Text
         diag=TRUE)
```

From the above map, the following are some of the facts that intrigue me:

1. Quality is **highly correlated** with **Alcohol and Volatile Acidity**, although in    opposite manners.

2. Fixed acidity seems to be **highly correlated** with **citric acid, density and       pH**.

3. pH seems to be **positively correlated** with **Volatile Acidity**. I assumed it to    be the other way round, i.e. similar to fixed acidity.

4. Sulphates and Chlorides seem to be **moderately positively correlated**. This may     not lead to an actual relationship though between the two chemicals specifically,     but it may be the case that they are present in proportionate amounts in good         quality wines.

####Let's look at some plots to verify our above hypothesis.

```{r echo=FALSE, message=FALSE}
# Quality vs Alcohol
ggplot(data = rdw, aes(y = alcohol, x = quality))+
  geom_boxplot(alpha = 1/3, color = "#2e70b2", fill = "#6fa9e2")+
  stat_summary(fun.y = mean, color = "red", geom = "point", shape = 4, size = 3)
 
```

So the alcohol content increases with quality, the exception in this plot being quality rating 5 with a large number of outliers. The mean values as well as the median values clearly express this fact. We can create percentage ranges for Alcohol levels and see the distribution of quality rating in each range as well.

```{r echo=FALSE}
rdw.alcohol.ranges <- cut(rdw$alcohol, breaks = c(8,9,10,11,13,15))
table(rdw.alcohol.ranges)
```
```{r echo=FALSE}
# Percentage wise Quality distribution
qplot(x=rdw.alcohol.ranges, data = rdw, fill = ordered(quality, c(8,7,6,5,4,3)))+
  scale_fill_brewer(type = "seq")
```

This graph shows that though the majority of **normal**(5 & 6) quality red wines are present in the 9-11% alcohol content range, the **exceptional** ones(7 & 8) tend to be on the higher side in alcohol levels.

Taking a look at volatile.acidity vs Quality, which is expected to have a high negative correlation.

```{r, echo=FALSE}
ggplot(aes(x = quality, y = volatile.acidity, group = 1), data = rdw)+
  geom_jitter(alpha = 1/3, color = "#37768e")+
  stat_summary(geom = "line", fun.y = "quantile", fun.args = list(probs = 0.97),
               color = "red", linetype = 2)+
  stat_summary(geom = "line", fun.y = "median", color = "black")+
  stat_summary(geom = "line", fun.y = "quantile", fun.args = list(probs = 0.03),
               color = "red", linetype = 2)
```

From the median, 97th percentile, and the 3rd percentile, we clearly see a declining relationship with quality. And normal quality values are packed mostly in the 0.2 to 0.8 range.

Let's have a look at fixed.acidity and variables correlated with it.

```{r echo=FALSE}
ggplot(aes(x = fixed.acidity, y = citric.acid), data = rdw)+
  geom_jitter(color = "#37768e", alpha = 1/2)+
  geom_smooth(method = "lm", color = "#ce1644")
```

Fixed acidity definitely increases with higher amounts of Citric acid. Probably because citric acid may be the main constituent of acidic nature of the wine. Volatile acidity has a negative relation, so we might need to investigate these together in Multivariate Analyses section.

Let's check the relationship between fixed.acidity and density.

```{r echo=FALSE, message=FALSE}
ggplot(aes(x = fixed.acidity, y = density), data = rdw)+
  geom_point(color = "#163470", alpha = 1/4)+
  geom_smooth(method = "lm", color = "#ce1644")

```

Clearly a positive relationship between these two factors. Let's see if density affects quality majorly.

```{r}
ggplot(aes(x = quality, y = density), data = rdw)+
 geom_boxplot(alpha = 1/3, color = "#2e70b2", fill = "#6fa9e2")+
  stat_summary(fun.y = mean, color = "red", geom = "point", shape = 4, size = 3)
```

This plot doesn't really lead to any new conclusions. Density isn't affective in determining quality.

What about acidity vs pH? Correlation coefficient for fixed.acidity is negative, which is to be expected as higher acidity implies lower pH Value. Let's check for volatile.acidity and citric.acid. We will keep the x axis in log scale to better view the data.

```{r echo=FALSE, message=FALSE}
# Fixed acidity vs pH
ggplot(aes(x = fixed.acidity, y = pH), data = rdw)+
  scale_x_log10()+
  geom_point(color = "#163470", alpha = 1/4)+
  geom_smooth(method = "lm", color = "#ce1644")

# Volatile acidity vs pH
ggplot(aes(x = volatile.acidity, y = pH), data = rdw)+
  scale_x_log10()+
  geom_point(color = "#163470", alpha = 1/4)+
  geom_smooth(method = "lm", color = "#ce1644")

# Citric acid vs pH
ggplot(aes(x = citric.acid, y = pH), data = subset(rdw, rdw$citric.acid > 0))+
  scale_x_log10()+
  geom_point(color = "#163470", alpha = 1/4)+
  geom_smooth(method = "lm", color = "#ce1644")
```

Clearly, volatile acidity has a positive relationship with pH as opposed to fixed.acidity and citric.acid. This finding is crucial, and will be evaluated further in the next section.

Let's have a look at Sulphates and Chlorides.

```{r echo=FALSE, message=FALSE}
ggplot(aes(x = sulphates, y = chlorides), data = rdw)+
  geom_line(color = "#163470")+
  geom_smooth(method = "lm", color = "#ce1644")

```

There is a basic linear relationship between the two, but a lot of outliers do exist. Let's compare them with Quality.

```{r echo =FALSE, message=FALSE}
# Sulphates vs Quality
ggplot(aes(x = quality, y = sulphates), data = rdw)+
  geom_boxplot(alpha = 1/3)+
  stat_summary(geom = "point", fun.y = mean, color = "red", shape = 3)

# Chlorides vs Quality
ggplot(aes(x = quality, y = chlorides), data = rdw)+
  geom_boxplot(alpha = 1/3)+
  stat_summary(geom = "point", fun.y = mean, color = "red", shape = 3)
```

Though for chlorides, the distribution across quality remains more or less constant,  we can see a large number of outliers for both chlorides and sulphates in the normal (5 & 6) quality wines.

# Bivariate Analysis

> **Tip**: As before, summarize what you found in your bivariate explorations
here. Use the questions below to guide your discussion.

### Talk about some of the relationships you observed in this part of the \
investigation. How did the feature(s) of interest vary with other features in \
the dataset?

### Did you observe any interesting relationships between the other features \
(not the main feature(s) of interest)?

### What was the strongest relationship you found?


# Multivariate Plots Section

> **Tip**: Now it's time to put everything together. Based on what you found in
the bivariate plots section, create a few multivariate plots to investigate
more complex interactions between variables. Make sure that the plots that you
create here are justified by the plots you explored in the previous section. If
you plan on creating any mathematical models, this is the section where you
will do that.

```{r echo=FALSE, Multivariate_Plots}

```

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the \
investigation. Were there features that strengthened each other in terms of \
looking at your feature(s) of interest?

### Were there any interesting or surprising interactions between features?

### OPTIONAL: Did you create any models with your dataset? Discuss the \
strengths and limitations of your model.

------

# Final Plots and Summary

> **Tip**: You've done a lot of exploration and have built up an understanding
of the structure of and relationships between the variables in your dataset.
Here, you will select three plots from all of your previous exploration to
present here as a summary of some of your most interesting findings. Make sure
that you have refined your selected plots for good titling, axis labels (with
units), and good aesthetic choices (e.g. color, transparency). After each plot,
make sure you justify why you chose each plot by describing what it shows.

### Plot One
```{r echo=FALSE, Plot_One}

```

### Description One


### Plot Two
```{r echo=FALSE, Plot_Two}

```

### Description Two


### Plot Three
```{r echo=FALSE, Plot_Three}

```

### Description Three

------

# Reflection

> **Tip**: Here's the final step! Reflect on the exploration you performed and
the insights you found. What were some of the struggles that you went through?
What went well? What was surprising? Make sure you include an insight into
future work that could be done with the dataset.

> **Tip**: Don't forget to remove this, and the other **Tip** sections before
saving your final work and knitting the final report!